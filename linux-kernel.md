# Table of Contents
- [Kernel](#kernel)
- [Device Tree](#dtc)
- [GCC commands](#gcc_commands)
- [Compiler symbol extraction](#symbol_extraction)
- [Misc](#misc)

<a name="kernel"></a>
## Kernel
- `make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- clean` - Remove object files
- `make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mrproper` - Remove intermediate files including .config
- `make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean`
- `make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- <defconfig>`
- `make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- menuconfig`
- `make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- zImage`
- `make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- <dt filename>.dtb` - Build an individual dts file
- `make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- dtbs- ` - Build all DTS
- `make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- modules- `
- `sudo make ARCH=arm INSTALL_MOD_PATH=<path to root of file system> modules_install`
 - `INSTALL_MOD_STRIP=1` - Pass it on to strip down debug info from the kernel module


<a name="dtc"></a>
## Device Tree
- [Convert DTS to DTB](https://gist.github.com/aakbar5/60e432b4e16843bef8656de88ab1e1b7)
- [Convert DTB to DTS](https://gist.github.com/aakbar5/60e432b4e16843bef8656de88ab1e1b7)


<a name="gcc_commands"></a>
## GCC commands
- Add `-P -E` to gcc commandline to generate pre-process code for inspection
- Add `-S` to gcc commandline to generate assembly code
- `gcc -dM -E - < /dev/null` - See list of compiler default macros in standard build
- `gcc -dM -E -O0 - < /dev/null` - See list of the compiler default macros with optimization level 0
- `g++ -dM -E -x c++ -std=c++11 - < /dev/null` - Compiler default macros in case of c++11


<a name="symbol_extraction"></a>
## Compiler symbol extraction

- `make kernelversion` - To see kernel version.
- `strip --strip-debug </path/to/input/lib/program> -o </path/to/output/file>` - Strip debug info
- `size --common --totals <path/to/obj/file/or/path/to/executable>` - Show sizes of the each section
    ```
    aarch64-poky-linux-size --common --totals vmlinux
    text	   data	    bss	    dec	    hex	filename
    15036748	8039596	 441152	23517496	166d938	vmlinux
    15036748	8039596	 441152	23517496	166d938	(TOTALS)
    ```
- `rm /etc/ld.so.cache && ldconfig` - Force the system to rebuild ld cache

- `nm -S --size-sort -s </path/to/executable/file>` - Getting symbols
- `nm </path/to/c++/library> | c++filt` - Demangles C++ symbols

- `readelf --wide --syms </path/to/.so/file/or/executable/file>` - See all symbols of a .so file
- `readelf --wide --sections </path/to/.so/file/or/executable/file>` - See summary of all sections
- `readelf --file-header </path/to/.so/file/or/executable/file>` - Show header of the ELF file.
                                            -- for so file: TYPE is DYN (Shared object file)

- `readelf libcl.so -W -d | grep NEEDED` - Get list of the external libraries required by the ELF object
- `readelf --all app` -
- `readelf --dynamic app` - Show dynamic sections of the app
- `readelf --header app` - Show the header of the file
- `readelf --headers app | grep 'Entry point'` - Show entry point address
- `readelf --relocs app` - Show relocation sections of the app
- `readelf --segments app` - Show segment headers

- `objdump -p /path/to/program | grep NEEDED` - Get list of the external libraries required by the ELF object
- `objdump --disassemble ./test | grep 100002b0
- `objdump --disassemble-all ./hello
- `objdump --syms ./fuse.ko | grep modinfo

- `hexdump -C /bin/ls

- `LD_DEBUG=all /path/to/app` - Can be used to dump debug info generated by the Linx dynamic linker

    ```
    Valid options for the LD_DEBUG environment variable are:

    libs        display library search paths
    reloc       display relocation processing
    files       display progress for input file
    symbols     display symbol table processing
    bindings    display information about symbol binding
    versions    display version dependencies
    all         all previous options combined
    statistics  display relocation statistics
    unused      determined unused DSOs
    help        display this help message and exit
    ```
    Ref: http://schillix.sourceforge.net/man/man1/ld.so.1.1.html


<a name="misc"></a>
## Misc

- `udevadm control --reload-rules && udevadm trigger` - For udev to reload rules
    - https://marc.info/?l=linux-usb&m=121459435621262&w=2

- Verify config of the running kernel
	- Dump config: `cat /proc/config.gz | gunzip > active_config.config` or `zcat /proc/config.gz > active_config.config`
    - Needs kernel support for this: `General setup > Kernel .config support > Enable access to .config through /proc/config.gz`.

- DRM manipulation via commandline
    - Chanage debug level
        - `cat /sys/module/drm/parameters/debug`
        - `echo 0xff > /sys/module/drm/parameters/debug`

    - Device status
        - `cat /sys/class/drm/card0-HDMI-A-1/status`
        - `cat /proc/meminfo | grep -i cma`
        - `cat /sys/kernel/debug/dma_buf/bufinfo`
        - `cat /sys/kernel/debug/dri/0/state`

 